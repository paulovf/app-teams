!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.OfficeHelpers=e()}}(function(){return function e(t,r,o){function n(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return n(r?r:e)},l,l.exports,e,t,r,o)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(s,a)}u((o=o.apply(e,t)).next())})},n=this&&this.__generator||function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(s=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[0,s.value]),r[0]){case 0:case 1:s=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){a.label=r[1];break}if(6===r[0]&&a.label<s[1]){a.label=s[1],s=r;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(r);break}s[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,i,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return{next:r(0),throw:r(1),return:r(2)}},i=e("./endpoint.manager"),s=e("./token.manager"),a=e("../helpers/utilities"),u=e("../helpers/dialog"),c=e("../errors/auth"),l=function(){function e(e,t){this.endpoints=e,this.tokens=t,null==e&&(this.endpoints=new i.EndpointManager),null==t&&(this.tokens=new s.TokenManager)}return e.prototype.authenticate=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var o=this.tokens.get(e),n=s.TokenManager.hasExpired(o);return n||t?r?this._openAuthDialog(e,!0):a.Utilities.isAddin?this._openAuthDialog(e,!1):this._openInWindowPopup(e):Promise.resolve(o)},e.isAuthDialog=function(e){return void 0===e&&(e=!1),!(e===!1&&!a.Utilities.isAddin)&&(!!/(access_token|code|error)/gi.test(location.href)&&(u.Dialog.close(location.href,e),!0))},e.prototype._openAuthDialog=function(e,t){return o(this,void 0,void 0,function(){var r,o,s,a,l;return n(this,function(n){switch(n.label){case 0:return r=this.endpoints.get(e),null==r?[2,Promise.reject(new c.AuthError("No such registered endpoint: "+e+" could be found."))]:(o=i.EndpointManager.getLoginParams(r),s=o.state,a=o.url,[4,new u.Dialog(a,1024,768,t).result]);case 1:return l=n.sent(),[2,this._handleTokenResult(l,r,s)]}})})},e.prototype._openInWindowPopup=function(e){var t=this,r=this.endpoints.get(e);if(null==r)return Promise.reject(new c.AuthError("No such registered endpoint: "+e+" could be found."));var o=i.EndpointManager.getLoginParams(r),n=o.state,s=o.url,a="width=1024,height=768,menubar=no,toolbar=no,location=no,resizable=yes,scrollbars=yes,status=no",u=window.open(s,r.provider.toUpperCase(),a);return new Promise(function(e,o){try{var i=400,s=setInterval(function(){try{if(u.document.URL.indexOf(r.redirectUrl)!==-1)return clearInterval(s),u.close(),e(t._handleTokenResult(u.document.URL,r,n))}catch(e){if(!u)return clearInterval(s),o(new c.AuthError("Popup window was closed"))}},i)}catch(e){return u.close(),o(new c.AuthError("Unexpected error occured while creating popup"))}})},e.prototype._exchangeCodeForToken=function(e,t,r){var o=this;return new Promise(function(n,i){if(null==e.tokenUrl)return console.warn("We couldn't exchange the received code for an access_token.\n                    The value returned is not an access_token.\n                    Please set the tokenUrl property or refer to our docs."),n(t);var s=new XMLHttpRequest;s.open("POST",e.tokenUrl),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-Type","application/json");for(var a in r)"Accept"!==a&&"Content-Type"!==a&&s.setRequestHeader(a,r[a]);s.onerror=function(){return i(new c.AuthError("Unable to send request due to a Network error"))},s.onload=function(){try{if(200===s.status){var t=JSON.parse(s.responseText);return null==t?i(new c.AuthError("No access_token or code could be parsed.")):"access_token"in t?(o.tokens.add(e.provider,t),n(t)):i(new c.AuthError(t.error,t.state))}if(200!==s.status)return i(new c.AuthError("Request failed. "+s.response))}catch(e){return i(new c.AuthError("An error occured while parsing the response"))}},s.send(JSON.stringify(t))})},e.prototype._getToken=function(e,t,r){void 0===e&&(e=location.href),void 0===t&&(t=location.origin),void 0===r&&(r="#"),t&&(e=e.replace(t,""));var o=e.split(r),n=o[0],i=o[1],s=null==i?n:i;if(s.indexOf("?")!==-1){var a=s.split("?"),u=(a[0],a[1]);s=u}return this._extractParams(s)},e.prototype._extractParams=function(e){if(null==e||""==e.trim())return null;for(var t,r={},o=/([^&=]+)=([^&]*)/g;null!==(t=o.exec(e));)r[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return r},e.prototype._handleTokenResult=function(e,t,r){var o=this._getToken(e,t.redirectUrl);if(null==o)throw new c.AuthError("No access_token or code could be parsed.");if(t.state&&+o.state!==r)throw new c.AuthError("State couldn't be verified");if("code"in o)return this._exchangeCodeForToken(t,o);if("access_token"in o)return this.tokens.add(t.provider,o);throw new c.AuthError(o.error,o.state)},e}();r.Authenticator=l},{"../errors/auth":4,"../helpers/dialog":6,"../helpers/utilities":9,"./endpoint.manager":2,"./token.manager":3}],2:[function(e,t,r){"use strict";var o=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=e("../helpers/utilities"),i=e("../helpers/storage");r.DefaultEndpoints={Google:"Google",Microsoft:"Microsoft",Facebook:"Facebook",AzureAD:"AzureAD"};var s=function(e){function t(){return e.call(this,"OAuth2Endpoints",i.StorageType.LocalStorage)||this}return o(t,e),t.prototype.add=function(t,r){return null==r.redirectUrl&&(r.redirectUrl=window.location.origin),r.provider=t,e.prototype.insert.call(this,t,r)},t.prototype.registerGoogleAuth=function(e,t){var o={clientId:e,baseUrl:"https://accounts.google.com",authorizeUrl:"/o/oauth2/v2/auth",resource:"https://www.googleapis.com",responseType:"token",scope:"https://www.googleapis.com/auth/plus.me",state:!0},i=n.Utilities.extend({},t,o);return this.add(r.DefaultEndpoints.Google,i)},t.prototype.registerMicrosoftAuth=function(e,t){var o={clientId:e,baseUrl:"https://login.microsoftonline.com/common/oauth2/v2.0",authorizeUrl:"/authorize",responseType:"token",scope:"https://graph.microsoft.com/user.read",extraParameters:"&response_mode=fragment",nonce:!0,state:!0},i=n.Utilities.extend({},t,o);this.add(r.DefaultEndpoints.Microsoft,i)},t.prototype.registerFacebookAuth=function(e,t){var o={clientId:e,baseUrl:"https://www.facebook.com",authorizeUrl:"/dialog/oauth",resource:"https://graph.facebook.com",responseType:"token",scope:"public_profile",nonce:!0,state:!0},i=n.Utilities.extend({},t,o);this.add(r.DefaultEndpoints.Facebook,i)},t.prototype.registerAzureADAuth=function(e,t,o){var i={clientId:e,baseUrl:"https://login.windows.net/"+t,authorizeUrl:"/oauth2/authorize",resource:"https://graph.microsoft.com",responseType:"token",nonce:!0,state:!0},s=n.Utilities.extend({},o,i);this.add(r.DefaultEndpoints.AzureAD,s)},t.getLoginParams=function(e){var r=e.scope?encodeURIComponent(e.scope):null,o=e.resource?encodeURIComponent(e.resource):null,n=e.state&&t.generateCryptoSafeRandom(),i=e.nonce&&t.generateCryptoSafeRandom(),s=["response_type="+e.responseType,"client_id="+encodeURIComponent(e.clientId),"redirect_uri="+encodeURIComponent(e.redirectUrl)];return r&&s.push("scope="+r),o&&s.push("resource="+o),n&&s.push("state="+n),i&&s.push("nonce="+i),e.extraQueryParameters&&s.push(e.extraQueryParameters),{url:e.baseUrl+e.authorizeUrl+"?"+s.join("&"),state:n}},t.generateCryptoSafeRandom=function(){var e=new Uint32Array(1);if("msCrypto"in window)window.msCrypto.getRandomValues(e);else{if(!("crypto"in window))throw new Error("The platform doesn't support generation of Cryptographically Safe Randoms. Please disable the state flag and try again");window.crypto.getRandomValues(e)}return e[0]},t}(i.Storage);r.EndpointManager=s},{"../helpers/storage":8,"../helpers/utilities":9}],3:[function(e,t,r){"use strict";var o=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=e("../helpers/storage"),i=function(e){function t(){return e.call(this,"OAuth2Tokens",n.StorageType.LocalStorage)||this}return o(t,e),t.setExpiry=function(e){var t=function(e){return null==e?null:new Date((new Date).getTime()+1e3*~~e)};null!=e&&null==e.expires_at&&(e.expires_at=t(e.expires_in))},t.hasExpired=function(e){return null==e||null!=e.expires_at&&(e.expires_at=e.expires_at instanceof Date?e.expires_at:new Date(e.expires_at),e.expires_at.getTime()-(new Date).getTime()<0)},t.prototype.get=function(r){var o=e.prototype.get.call(this,r);if(null==o)return o;var n=t.hasExpired(o);return n?(e.prototype.remove.call(this,r),null):o},t.prototype.add=function(r,o){return o.provider=r,t.setExpiry(o),e.prototype.insert.call(this,r,o)},t}(n.Storage);r.TokenManager=i},{"../helpers/storage":8}],4:[function(e,t,r){"use strict";var o=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=function(e){function t(t,r){var o=e.call(this,t)||this;if(o.state=r,o.name="AuthError",o.message=t,Error.captureStackTrace)Error.captureStackTrace(o,o.constructor);else{var n=new Error;if(n.stack){var i=n.stack.match(/[^\s]+$/);o.stack=o.name+" at "+i}}return o}return o(t,e),t}(Error);r.AuthError=n},{}],5:[function(e,t,r){"use strict";var o=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},n=function(e){function t(t,r){var o=e.call(this,t)||this;if(o.innerError=r,o.name="DialogError",o.message=t,Error.captureStackTrace)Error.captureStackTrace(o,o.constructor);else{var n=new Error;if(n.stack){var i=n.stack.match(/[^\s]+$/);o.stack=o.name+" at "+i}}return o}return o(t,e),t}(Error);r.DialogError=n},{}],6:[function(e,t,r){"use strict";var o=e("./utilities"),n=e("../errors/dialog"),i=function(){function e(e,t,r,o){if(void 0===e&&(e=location.origin),void 0===t&&(t=1024),void 0===r&&(r=768),void 0===o&&(o=!1),this.url=e,this.width=t,this.height=r,this.useTeamsDialog=o,!/^https/.test(e))throw new n.DialogError("URL has to be loaded over HTTPS.");this.size=this._optimizeSize(t,r)}return Object.defineProperty(e.prototype,"result",{get:function(){return null==this._result&&(this._result=this.useTeamsDialog?this._teamsDialog():this._addinDialog()),this._result},enumerable:!0,configurable:!0}),e.prototype._addinDialog=function(){var e=this;return new Promise(function(t,r){Office.context.ui.displayDialogAsync(e.url,{width:e.size.width$,height:e.size.height$},function(o){if(o.status===Office.AsyncResultStatus.Failed)throw new n.DialogError(o.error.message);var i=o.value;i.addEventHandler(Office.EventType.DialogMessageReceived,function(o){try{var s=e._safeParse(o.message);t(s.parse?e._safeParse(s.value):s.value)}catch(e){r(new n.DialogError("An unexpected error in the dialog has occured.",e))}finally{i.close()}}),i.addEventHandler(Office.EventType.DialogEventReceived,function(e){try{r(new n.DialogError(e.message,e.error))}catch(e){r(new n.DialogError("An unexpected error in the dialog has occured.",e))}finally{i.close()}})})})},e.prototype._teamsDialog=function(){var e=this;return new Promise(function(t,r){try{microsoftTeams.initialize()}catch(e){}microsoftTeams.authentication.authenticate({url:e.url,width:e.size.width,height:e.size.height,failureCallback:function(e){return r(new n.DialogError("Error while launching dialog",e))},successCallback:function(e){return t(e)}})})},e.close=function(e,t){void 0===t&&(t=!1);var r=!1,i=e;if(null!=i&&"object"==typeof i)r=!0,i=JSON.stringify(i);else if("function"==typeof e)throw new n.DialogError("Invalid message. Canno't pass functions as arguments");try{if(t){try{microsoftTeams.initialize()}catch(e){}microsoftTeams.authentication.notifySuccess(JSON.stringify({parse:r,value:i}))}else o.Utilities.isAddin&&Office.context.ui.messageParent(JSON.stringify({parse:r,value:i}))}catch(e){throw new n.DialogError("Canno't close dialog",e)}},e.prototype._getSize=function(e,t){var r=window.screen.width;return e&&t?this._optimizeSize(e,t):r<=640?this._optimizeSize(640,480):r<=1366?this._optimizeSize(1024,768):r<=1920?this._optimizeSize(1600,900):void 0},e.prototype._optimizeSize=function(e,t){var r=window.screen.width,o=window.screen.height,n=this._maxSize(e,r),i=this._maxSize(t,o);return{width$:this._percentage(n,r),height$:this._percentage(i,o),width:n,height:i}},e.prototype._maxSize=function(e,t){return e<t-30?e:t-30},e.prototype._percentage=function(e,t){return 100*e/t},e.prototype._safeParse=function(e){try{var t=JSON.parse(e);return t}catch(t){return e}},e}();r.Dialog=i},{"../errors/dialog":5,"./utilities":9}],7:[function(e,t,r){"use strict";var o=function(){function e(e){this.items=e,(this.items!==new Object(this.items)||Array.isArray(this.items))&&(this.items={})}return e.prototype.get=function(e){return this.contains(e)?this.items[e]:null},e.prototype.add=function(e,t){if(this.contains(e))throw new Error("Key: "+e+" already exists.");return this.insert(e,t)},e.prototype.insert=function(e,t){if(null==e)throw new Error("Key cannot be null or undefined");return this.items[e]=t,t},e.prototype.remove=function(e){if(!this.contains(e))throw new Error("Key: "+e+" not found.");var t=this.items[e];return delete this.items[e],t},e.prototype.clear=function(){this.items={}},e.prototype.contains=function(e){if(null==e)throw new Error("Key cannot be null or undefined");return this.items.hasOwnProperty(e)},e.prototype.keys=function(){return null==this.items?[]:Object.keys(this.items)},e.prototype.values=function(){var e=this;return this.keys().map(function(t){return e.items[t]})},e.prototype.lookup=function(){return this.keys().length?JSON.parse(JSON.stringify(this.items)):null},Object.defineProperty(e.prototype,"count",{get:function(){return this.keys().length},enumerable:!0,configurable:!0}),e}();r.Dictionary=o},{}],8:[function(e,t,r){"use strict";var o,n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=e("./dictionary"),s=e("./utilities");!function(e){e[e.LocalStorage=0]="LocalStorage",e[e.SessionStorage=1]="SessionStorage"}(o=r.StorageType||(r.StorageType={}));var a=function(e){function t(r,n){var i=e.call(this)||this;return i.container=r,i._storage=null,i._notifyObservers=function(e){return t._observers.forEach(function(t){return t(e)})},n=n||o.LocalStorage,i.switchStorage(n),i._registerStorageEvent(),i}return n(t,e),t.prototype.switchStorage=function(e){this._storage=e===o.LocalStorage?localStorage:sessionStorage,this._storage.hasOwnProperty(this.container)||(this._storage[this.container]=null),this.load()},t.prototype.add=function(t,r){return this.load(),e.prototype.add.call(this,t,r),this.save(),r},t.prototype.insert=function(t,r){return this.load(),e.prototype.insert.call(this,t,r),this.save(),r},t.prototype.remove=function(t){this.load();var r=e.prototype.remove.call(this,t);return this.save(),r},t.prototype.clear=function(){e.prototype.clear.call(this),this._storage.removeItem(this.container)},t.clearAll=function(){window.localStorage.clear(),window.sessionStorage.clear()},t.prototype.save=function(){this._storage.setItem(this.container,JSON.stringify(this.items))},t.prototype.load=function(){var e=JSON.parse(this._storage.getItem(this.container));this.items=s.Utilities.extend({},this.items,e)},t.prototype.onStorage=function(e){t._observers.push(e)},t.prototype._registerStorageEvent=function(){var e=this;this.onStorage(function(t){return e.load()}),t._storageEventRegistered||(window.onstorage=function(t){return e._notifyObservers(t)},t._storageEventRegistered=!0)},t}(i.Dictionary);a._observers=[],r.Storage=a},{"./dictionary":7,"./utilities":9}],9:[function(e,t,r){"use strict";function o(){var e="WEB",t=null,r=null;try{if(null==window.sessionStorage)throw new Error("Session Storage isn't supported");var o=window.sessionStorage.hostInfoValue;n=o.split("$"),e=n[0],t=n[1],r=n[2],null==r&&(i=o.split("|"),e=i[0],t=i[1]),e=e.toUpperCase()||"WEB",t=t.toUpperCase()||null}catch(e){}return{host:e,platform:t};var n,i}r.HostType={WEB:"WEB",ACCESS:"ACCESS",EXCEL:"EXCEL",ONENOTE:"ONENOTE",OUTLOOK:"OUTLOOK",POWERPOINT:"POWERPOINT",PROJECT:"PROJECT",WORD:"WORD"},r.PlatformType={IOS:"IOS",MAC:"MAC",OFFICE_ONLINE:"OFFICE_ONLINE",PC:"PC"};var n=function(){function e(){}return e.extend=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=arguments.length;if(o<2||null==e)return e;t&&(e=Object(e));for(var n=1;n<o;n++){var i=arguments[n];if(null!=i)for(var s=Object.keys(i),a=s.length,u=0;u<a;u++){var c=s[u];t&&void 0!==e[c]||(e[c]=i[c])}}return e},Object.defineProperty(e,"host",{get:function(){var e=o();return r.HostType[e.host]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"platform",{get:function(){var t=o();if(e.host===r.HostType.WEB)return null;var n={IOS:r.PlatformType.IOS,MAC:r.PlatformType.MAC,WEB:r.PlatformType.OFFICE_ONLINE,WIN32:r.PlatformType.PC};return n[t.platform]||null},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isAddin",{get:function(){return e.host!==r.HostType.WEB},enumerable:!0,configurable:!0}),e.log=function(e){null==e?console.error(e):"string"==typeof e?console.error(e):(console.group(e.message||e.name||"Unhandled Exception"),console.error(e),null==e.stack&&(console.groupCollapsed("Stack Trace"),console.error(e.stack),console.groupEnd()),window.OfficeExtenstion&&e instanceof OfficeExtension.Error&&(console.groupCollapsed("Debug Info"),console.error(e.debugInfo),console.groupEnd()),console.groupEnd())},e}();r.Utilities=n},{}],"office-js-helpers":[function(e,t,r){"use strict";function o(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}o(e("./errors/dialog")),o(e("./errors/auth")),o(e("./helpers/dialog")),o(e("./helpers/utilities")),o(e("./helpers/dictionary")),o(e("./helpers/storage")),o(e("./helpers/dialog")),o(e("./authentication/token.manager")),o(e("./authentication/endpoint.manager")),o(e("./authentication/authenticator"))},{"./authentication/authenticator":1,"./authentication/endpoint.manager":2,"./authentication/token.manager":3,"./errors/auth":4,"./errors/dialog":5,"./helpers/dialog":6,"./helpers/dictionary":7,"./helpers/storage":8,"./helpers/utilities":9}]},{},[])("office-js-helpers")});